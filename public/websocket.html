<!doctype html>
<head>
<script type="text/javascript" src="/public/jquery-1.9.1.min.js"></script>
  <script type="text/javascript" src="/public/jquery.url-0.0.1.js"></script>
  <script type="text/javascript" src="/public/jquery.WebSocket.js"></script>
</head>
<body style="margin-left:100px;">
<h2>
   <a href="http://www.translunardesigns.com" alt="Trans Lunar Designs" target="_blank" >
      <img src="/public/translunar.png" align="middle"/>REST Test
   </a>
</h2>
<h3>Websocket Test</h3>

<form name="inputForm" id="inputForm">
<table>
   <tr>
      <td>
         <input id="formButton" type="button" value="Start">
		     <input id="formButton2" type="button" value="Stop">
      </td>
   </tr>
</table>
</form>
  <P>Time: <span id='output'><span></p>
<p><a href="/public/index.html">Home</a></p>
<p>
<ol>
<li>Start the websocket</li>
<li>See the time update</li>
<li>Stop the websocket</li>
</ol>
</p>
<script type="text/javascript">
   $(document).ready(function() {
     $('#formButton').click(function() { formSubmit(); });
     $('#formButton2').click(function() { formSubmit2(); });
   });

     // The WebSocket-Object (with resource + fallback)
     var ws = $.WebSocket('ws://127.0.0.1:9999');

     // WebSocket onerror event triggered also in fallback
     ws.onerror = function(e) {alert('Error with WebSocket uid: ' + e.target.uid);};


     /**
      * demonstrate multiplexing
      */
     var pipe1;

     // if connection is opened => start opening a pipe (multiplexing)
     ws.onopen = function() {
       //
       pipe1 = ws.registerPipe('user/all', null, {
         onopen: function() {
           console.log('pipe1 (' + this.uid + ') connected!');
         },
         onmessage: function(e) {
           console.log('< pipe1 : ' + e.data);
         },
         onerror: function(e) {
           console.log('< pipe1 error : ' + e.data);
         },
         onclose: function() {
           console.log('pipe1 (' + pipe.uid + ') connection closed!');
         }
       });
     };

   function formSubmit() {
alert("Start socket TODO");
     $('#output').text('TODO');
     ws.send({command:'start'});
     /*
     socket.sendMessage({command: 'start'});
    socket.on('message', function(square) {

    });

     */
   }
   function formSubmit2() {
alert("Stop socket TODO");
     // socket.sendMessage({command: 'stop'});
$('#output').text('');
   }

</script>

</body>
